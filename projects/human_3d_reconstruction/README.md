# human_3d_reconstruction

## Setup instructions
1. Clone the repository
    ```
    git clone https://github.com/KushajveerSingh/human_3d_reconstruction.git
    cd human_3d_reconstruction
    ```
2. If you have already installed [Miniconda](https://docs.conda.io/en/latest/miniconda.html) on your system, then comment out the first 5 lines in `setup.sh`, so you don't install it again. To be specific, comment out these line
    ```
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh -b
    rm Miniconda3-latest-Linux-x86_64.sh
    conda init bash
    source ~/.bashrc
    ```

    If you are using [Anaconda](https://www.anaconda.com/) or you have installed Miniconda not in the default location, then modify this line in `setup.sh` with the appropriate location of *conda*
    ```
    source ~/miniconda3/etc/profile.d/conda.sh
    ```
3. Run `./setup.sh`. This script will do the following
    - Install Miniconda if not already installed
    - Create a new conda environment called *human_3d*
    - Install python 3.7 (you can try python 3.8, 3.9, ... and run `./main.sh` to test if it works)
    - Install pytorch 1.11 with cuda 11.3 (you can try the more recent versions if needed and run `./main.sh` to test if it works)
    - Download insetgan, pifuhd, pose estimation models

## How to generate .obj files?
**Note**:- You need a GPU with atleast 12GB memory to run all the models. I tested the script on RTX A5000 with 24GB memory.
1. Ensure you are in *human_3d* conda environment (`conda activate human_3d`)
2. Goto `insetgan/config_2.py` and modify the following lines as per your requirement
    ```python
    selected_bodies = [3, 9, 3, 9, 3, 9, 24, 11, 24, 11, 24, 11]
    selected_faces  = [4, 4, 19, 19, 30, 30, 0, 0, 10, 10, 20, 20] 
    ```

    The length of `selected_bodies` specifies the number of images that will be generated. You can always add logic to this file to generate `selected_bodies` dynamically. The following example will generate 100 random images
    ```python
    import random
    selected_bodies, selected_faces = [], []
    
    for _ in range(100):
        selected_bodies.append(random.randint(0, 60))
        selected_faces.append(random.randint(0, 50))
    ```
3. Run `./setup.sh`.

After running `./setup.sh` you will get the results in the following directories
- `results/insetgan` - all the images (`img_{selected_bodies[i]}_{selected_faces[i]}.png`) generated by *insetgan* are stored here. This folder will also include `{img}_rect.txt` files. These files are generated by the pose estimation model and are used to crop the body from the image.
- `results/pifuhd_final/recon` - all the `.obj` files generated by *pifuhd* model are stored here. The naming scheme of the files is `result_{img}.obj`

To view the object files in VSCode you can install [3D Viewer for VSCode](https://marketplace.visualstudio.com/items?itemName=slevesque.vscode-3dviewer) extension (press `Ctrl+P` and enter `ext install slevesque.vscode-3dviewer` to install the extension). The default `results` folder contains output of two images generated by running `./main.sh`.